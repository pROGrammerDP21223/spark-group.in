# ====================================
# Professional Dealer Website
# SEO-Friendly URL Routing
# ====================================

RewriteEngine On
# RewriteBase is auto-detected, but can be set if needed
# For root domain: Remove or comment out RewriteBase
# For subdirectory: Set RewriteBase /your-subdirectory/
# RewriteBase /

# Prevent directory listing
Options -Indexes

# Security Headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

# ====================================
# Admin Routes - Allow direct access to PHP files
# ====================================
# Don't rewrite if the file exists
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
# Only rewrite admin routes if it's not a PHP file
RewriteCond %{REQUEST_URI} !\.php$ [NC]
RewriteRule ^admin/(.*)$ admin/index.php?route=$1 [L,QSA]

# ====================================
# Public Website Routes
# ====================================

# Sitemap
RewriteRule ^sitemap\.xml$ public/sitemap.php [L]

# API Routes
RewriteRule ^api/(.*)$ public/api/$1 [L,QSA]

# Static Pages
RewriteRule ^about-us$ public/index.php?page=about [L,QSA]
RewriteRule ^certifications$ public/index.php?page=certifications [L,QSA]
RewriteRule ^testimonials$ public/index.php?page=testimonials [L,QSA]
RewriteRule ^contact-us$ public/index.php?page=contact [L,QSA]
RewriteRule ^enquiry$ public/index.php?page=enquiry [L,QSA]
RewriteRule ^search$ public/index.php?type=search [L,QSA]
RewriteRule ^404$ public/index.php?page=404 [L,QSA]

# Product Routes (with optional city) - MUST come first (most specific)
# /bosch/power-tools/drill-machine-pune (with city)
RewriteRule ^([a-z0-9-]+)/([a-z0-9-]+)/([a-z0-9-]+)-([a-z0-9-]+)$ public/index.php?type=product&brand=$1&category=$2&slug=$3&city=$4 [L,QSA]
# /bosch/power-tools/drill-machine (without city)
RewriteRule ^([a-z0-9-]+)/([a-z0-9-]+)/([a-z0-9-]+)$ public/index.php?type=product&brand=$1&category=$2&slug=$3 [L,QSA]

# Category Routes (with optional city) - MUST come before brand routes
# /bosch/power-tools-pune (with city)
RewriteRule ^([a-z0-9-]+)/([a-z0-9-]+)-([a-z0-9-]+)$ public/index.php?type=category&brand=$1&slug=$2&city=$3 [L,QSA]
# /bosch/power-tools (without city)
RewriteRule ^([a-z0-9-]+)/([a-z0-9-]+)$ public/index.php?type=category&brand=$1&slug=$2 [L,QSA]

# Brand Routes (with optional city)
# /bosch-pune (with city) - MUST come before single slug
RewriteRule ^([a-z0-9-]+)-([a-z0-9-]+)$ public/index.php?type=brand&slug=$1&city=$2 [L,QSA]
# /bosch (without city) - Fallback to single slug (brand only)
RewriteRule ^([a-z0-9-]+)$ public/index.php?type=brand&slug=$1 [L,QSA]

# Home Page
RewriteRule ^$ public/index.php [L,QSA]

# ====================================
# File Access Protection
# ====================================
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|sql)$">
    # Apache 2.4 syntax (preferred)
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    # Apache 2.2 fallback
    <IfModule !mod_authz_core.c>
        Order Allow,Deny
        Deny from all
    </IfModule>
</FilesMatch>

# ====================================
# Image Optimization
# ====================================
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>

# ====================================
# Gzip Compression
# ====================================
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

